name: GitHub Metrics

on:
  schedule: [{cron: "0 */12 * * *"}]
  workflow_dispatch:
  push: {branches: ["master", "main"]}

jobs:
  github-metrics:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Activity Graphs (Right)
        uses: lowlighter/metrics@latest
        with:
          # New filename to force update
          filename: metrics.right.svg
          token: ${{ secrets.METRICS_TOKEN }}
          committer_token: ${{ secrets.METRICS_TOKEN }}
          
          # Classic template is REQUIRED for these charts
          template: classic
          
          # Hide header/user info to avoid duplication
          base: "" 
          config_timezone: America/Sao_Paulo
          
          # ORDER: Languages -> Habits (Day/Week Charts) -> Calendar (Heatmap)
          config_order: languages, habits, calendar
          
          # 1. Tech Stack (Bar Chart)
          plugin_languages: yes
          plugin_languages_details: bytes-size, percentage
          plugin_languages_sections: most-used
          plugin_languages_limit: 8
          
          # 2. Habits (Recent Activity Charts)
          plugin_habits: yes
          plugin_habits_from: 100       # Scan last 100 events
          plugin_habits_days: 14        # Limit to recent 2 weeks (Recent activity)
          plugin_habits_facts: no       # DISABLE text facts (Prevents the crash!)
          plugin_habits_charts: yes     # Show the Day/Night & Week graphics
          plugin_habits_trim: yes
          
          # 3. Calendar (Standard Flat Heatmap)
          plugin_calendar: yes
          plugin_calendar_limit: 1
          
          # Disable other visual plugins
          plugin_lines: no
          plugin_repositories: no
          plugin_activity: no
          plugin_achievements: no
